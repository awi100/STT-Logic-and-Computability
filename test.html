<!DOCTYPE html>
<html>
  <body>
    <script>

  // function findNextOperator(text){
  //   var i;
  //   for(i = 0; i < text.length; i++)
  //     var char = text.charAt(i);
  //     if (char == '|' || char == '^')
  //       break;
  //   return i;
  // }

  function isLiteral(express){
    return express.e1.length == 1 && express.e1 != '~' && express.e2 == null;
  }

  function reit(express1, express2){
    if (express1 == null || express2 == null)
      return true;
    var e1isLit = isLiteral(express1), e2isLit = isLiteral(express2);
    if (!e1isLit && !e2isLit){
      return reit(express1.e1, express2) && reit(express1.e2, express2) && reit(express1, express2.e1) && reit(express1, express2.e2);
    }
    else if (!e1isLit){
      return reit(express1.e1, express2) && reit(express1.e2, express2);
    }
    else if (!e2isLit){
      return reit(express1, express2.e1) && reit(express1, express2.e2);
    }
    var sameLit = express1.e1 == express2.e1;
    if (sameLit && express1.value != express2.value)
      return false;
    else
      return true;
}

  function checkReit(){
    var first = {e1: "A", e2: null, value: true, oper: null, depth: 0};
    var second = {e1: {e1: "A", e2: null, value: true, oper: null, depth: 1},
                  e2: {e1: "B", e2: null, value: null, oper: null, depth: 1},
                  value: null, oper: "^", depth: 0};
    var third = {e1: {e1: "A", e2: null, value: false, oper: null, depth: 1},
                  e2: {e1: "B", e2: null, value: null, oper: null, depth: 1},
                  value: null, oper: "^", depth: 0};
    var fourth = {e1: "D", e2: null, value: true, oper: null, depth: 0};
    var fifth = {e1: {e1: "A", e2: null, value: false, oper: null, depth: 1}, e2: null, value: true, oper: "~", depth: 0}
    console.log(reit(first, second));
    console.log(reit(first, third));
    console.log(reit(second, third));
    console.log(reit(first, fourth));
    console.log(reit(first, fifth));

  }

  function and(express){
    if (express.value == true){
      return express.e1.value == true && express.e2.value == true;
    }
    else{
      return express.e1.value == false || express.e2.value == false;
    }
  }

  function checkAnd(){
    var first = {e1: {e1: "A", e2: null, value: true, oper: null, depth: 1}, 
                 e2: {e1: "B", e2: null, value: true, oper: null, depth: 1}, 
                 value: true, oper: "^", depth: 0};
    var second = {e1: {e1: "A", e2: null, value: true, oper: null, depth: 1}, 
                 e2: {e1: "B", e2: null, value: false, oper: null, depth: 1}, 
                 value: false, oper: "^", depth: 0};
    var third = {e1: {e1: "A", e2: null, value: false, oper: null, depth: 1}, 
                 e2: {e1: "B", e2: null, value: true, oper: null, depth: 1}, 
                 value: true, oper: "^", depth: 0};
    var fourth = {e1: {e1: "A", e2: null, value: true, oper: null, depth: 1}, 
                 e2: {e1: "B", e2: null, value: true, oper: null, depth: 1}, 
                 value: false, oper: "^", depth: 0};     
    var fifth = {e1: {e1: "A", e2: null, value: false, oper: null, depth: 1}, 
                 e2: {e1: "B", e2: null, value: false, oper: null, depth: 1}, 
                 value: true, oper: "^", depth: 0};
    console.log(and(first));      
    console.log(and(second));  
    console.log(and(third)); 
    console.log(and(fourth)); 
    console.log(and(fifth));    
  }
  function or(express){
    if (express.value == true){
      return express.e1.value == true || express.e2.value == true;
    }
    else{
      return express.e1.value == false && express.e2.value == false;
    }
  }
    function checkOr(){
    var first = {e1: {e1: "A", e2: null, value: true, oper: null, depth: 1}, 
                 e2: {e1: "B", e2: null, value: true, oper: null, depth: 1}, 
                 value: true, oper: "^", depth: 0};
    var second = {e1: {e1: "A", e2: null, value: true, oper: null, depth: 1}, 
                 e2: {e1: "B", e2: null, value: false, oper: null, depth: 1}, 
                 value: false, oper: "^", depth: 0};
    var third = {e1: {e1: "A", e2: null, value: false, oper: null, depth: 1}, 
                 e2: {e1: "B", e2: null, value: true, oper: null, depth: 1}, 
                 value: true, oper: "^", depth: 0};
    var fourth = {e1: {e1: "A", e2: null, value: true, oper: null, depth: 1}, 
                 e2: {e1: "B", e2: null, value: true, oper: null, depth: 1}, 
                 value: false, oper: "^", depth: 0};     
    var fifth = {e1: {e1: "A", e2: null, value: false, oper: null, depth: 1}, 
                 e2: {e1: "B", e2: null, value: false, oper: null, depth: 1}, 
                 value: true, oper: "^", depth: 0};
    console.log(or(first));      
    console.log(or(second));  
    console.log(or(third)); 
    console.log(or(fourth)); 
    console.log(or(fifth));    
  }

  //function to check if there are parens around the 
  //expression that are serving no purpose
  function checkUselessParens(text){
    if (text.charAt(0) != '(' || text.charAt(text.length-1) != ')')
      return false;
    var level = 0, i = 0, useless = true, char;
    //if the level is 0 somewhere inside the expression before  
    //the last closing paren then the parens are not useles
    for (i = 0; i < text.length-1; i++){
      char = text.charAt(i);
      if (char == '(')
        level++;
      if (char == ')')
        level--;
      if (level == 0)
        useless = false;
    }
    return useless;
  }

  function isOperator(char){
    return char == '|' || char == '^';
  }
  //can be passed a char or charCode
  function charIsLiteral(char){
    if (typeof char == "string"){
      charCode = char.charCodeAt(0);
      return charCode > 64 && charCode < 91;
    }
    return char > 64 && char < 91;
  }

  function checkValidAlphabet(text){
    var char;
    for (var i = 0; i < text.length; i++){
      var charCode = text.charCodeAt(i);
      var char = text.charAt(i);
      if (!(charCode >= 65 && charCode <= 90) && char != '(' && char != ')' && char != ' ' && char != '^' && char != '|' && char != '~')
        return false;
    }
    return true;
  }

  function validateInput(text){
    if (checkValidAlphabet(text) == false) return "Characters used not in valid alphabet";
    var level = 0, i = 0, numOfZeroDepths = 0, containsParens = false, anotherOperatorAppeared = false;
    for (i = 0; i < text.length; i++){
      var char = text.charAt(i);
      var charCode = text.charCodeAt(i);
      if (char == '('){
        containsParens = true;
        level++;
      }
      if (char == ')'){
        containsParens = true;
        level--;
      }
      if (numOfZeroDepths == 1 && isOperator(char) && level == 0) anotherOperatorAppeared = true;
      //check that you're at level 0 again after another operator appeared
      if (numOfZeroDepths > 0 && anotherOperatorAppeared && level == 0)
        numOfZeroDepths++;
      //else if you're at level 0 for the first time
      else if (level == 0 && numOfZeroDepths == 0 && isOperator(char))
        numOfZeroDepths++;
      //check for another operator appearing on level 0
      
      //check for literals longer than 1 char
      if(i > 0 && charIsLiteral(char) && charIsLiteral(text.charAt(i-1)))
        return "Literals must be length 1";
      //check that literals are not double spaced
      if (i > 1 && text.charAt(i-1) == ' ' && text.charAt(i-2) == ' ')
        return "Input cannot be double spaced";
      //check that chars are seperated with operator 
      if (i > 1 && charIsLiteral(char) && (text.charAt(i-1) == ' ' || text.charAt(i-1) == '(' || text.charAt(i-1) == ')') && charIsLiteral(text.charAt(i-2)))
        return "Literals must be seperated by an operator";
      //check that operators are seperated with a literal
      if (i > 1 && isOperator(char) && isOperator(text.charAt(i-1)))
        return "Operators must be seperated by a literal";
      if (i > 1 && isOperator(char) && (text.charAt(i-1) == ' ' || text.charAt(i-1) == '(' || text.charAt(i-1) == ')') && isOperator(text.charAt(i-2)))
        return "Operators must be seperated by a literal";
    }
    //cannot have two operators at the top level
    if (numOfZeroDepths > 1 && containsParens) return "Only 1 main operator allowed.";
    //cannot have a different # of left than right parens
    if (level != 0) return "Uneven number of open and closed parens.";

    return "";
  }

	function createObject(text, counter){
    //for consistency
    text = text.toUpperCase()
    //clean text of spaces
    if (text.charAt(0) == ' ') 
      text = text.substring(1, text.length);
    if (text.charAt(text.length-1) == ' ') 
      text = text.substring(0, text.length-1);
    var errMsg = validateInput(text);
    if (errMsg != ""){
      document.getElementById('myText').value = errMsg;  
      return;
    }
    var express;
    //get rid of outer brackets if not needed
    while (checkUselessParens(text)){
      text = text.substring(1, text.length-1);
    }
    //return literal (base case)
    if (text.length == 1){
      express = {e1: text, e2: null, value: null, oper: null, depth: counter};
      console.log(express);
      return express;
    }
    if (text.length == 2){
      var neg = text.charAt(0);
      var lit = text.charAt(1);
      var myLit = {e1: lit, e2: null, value: null, oper: null, depth: counter+1};
      express = {e1: myLit, e2: null, value: null, oper: neg, depth: counter};
      console.log(express);
      return express;
    }
    //calculate the max depth level
    var i, maxLevelTracker = 1, maxLevel = 0;
    for(i = 0; i < text.length; i++){
      var char = text.charAt(i);
      if (char == '(') maxLevelTracker++;
      if (char == ')') maxLevelTracker--;
      if (maxLevelTracker > maxLevel) maxLevel = maxLevelTracker;
    }
    //find the 0 level operator and recurse
    var level = 0;
    for (i = 0; i < text.length; i++){
      var char = text.charAt(i);
      if (char == '(')
        level++;
      if (char == ')')
        level--;
      if (isOperator(char) && level == 0){
        var left = text.substring(0, i);
        var right = text.substring(i+1, text.length);
        express = {e1: createObject(left, counter+1), e2: createObject(right, counter+1), value: null, oper: char, depth: counter};
        console.log(express);
        return express;
     }
    }
	}    	
    </script>

    Input: <input type="text" id="myText" value="">

	<p>Input string expressions</p>

  <p>((a | b) ^ c)</p>
  <p>(a ^ b) | (c ^ d)</p>
  <p>(((A | B) ^ C) | D) > E</p>
  <p>(a | b) ^ c ^ (d | e)</p>

	<button onclick="createObject(document.getElementById('myText').value, 0)">Submit</button>

  <button onclick="checkReit()">TestReit</button>

  <button onclick="checkAnd()">TestAnd</button>

  <button onclick="checkOr()">TestOr</button>
  </body>
</html>

